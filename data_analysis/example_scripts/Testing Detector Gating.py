# ---
# jupyter:
#   jupytext:
#     text_representation:
#       extension: .py
#       format_name: percent
#       format_version: '1.3'
#       jupytext_version: 1.13.8
#   kernelspec:
#     display_name: Python 3 (ipykernel)
#     language: python
#     name: python3
# ---

# %% [markdown]
# We begin by moving to the project **directory**, loading neccessary **packages and modules**, and **defining constants**:

# %%
######################################
# importing core and 3rd-party modules
######################################

import os
import sys
import pickle
from pathlib import Path
from winsound import Beep
from copy import deepcopy
from types import SimpleNamespace
from contextlib import suppress

import matplotlib as mpl

mpl.use("nbAgg")
import numpy as np
from IPython.core.debugger import set_trace

###############################################
# Move to project root to easily import modules
###############################################

try:  # avoid changes if already set
    print("Working from: ", PROJECT_ROOT)
except NameError:
    try:  # running from Spyder
        PROJECT_ROOT = Path(__file__).resolve()
    except NameError:  # running as Jupyter Notebook
        PROJECT_ROOT = Path(os.getcwd()).resolve().parent.parent
    os.chdir(PROJECT_ROOT)
    print("Working from: ", PROJECT_ROOT)

from data_analysis.correlation_function import (
    SolutionSFCSExperiment,
    calculate_calibrated_afterpulse,
)
from utilities.display import Plotter

#################################################
# Setting up data path and other global constants
#################################################

DATA_ROOT = Path("D:\OneDrive - post.bgu.ac.il\gSTED_sFCS_Data")  # Laptop/Lab PC (same path)
# DATA_ROOT = Path("D:\???")  # Oleg's
DATA_TYPE = "solution"

# %% [markdown]
# Choosing the data templates:

# %%
FORCE_ALL = True
# FORCE_ALL = False

data_label_kwargs = {
    "gated 12 uW": dict(
        date="18_10_2022",
        confocal_template="gated_15ns_angular_exc_161655_*.pkl",
        sted_template=None,
        file_selection="Use 1-5",
        force_processing=False or FORCE_ALL,
        afterpulsing_method="filter (lifetime)",
    ),
    "200 nW": dict(
        date="18_10_2022",
        confocal_template="25XDilutedConcentratedSample_200nW_exc_noGating_angular_exc_152653_*.pkl",
        sted_template=None,
        file_selection="Use 1-2",
        force_processing=False or FORCE_ALL,
        afterpulsing_method="filter (lifetime)",
    ),
}

data_labels = list(data_label_kwargs.keys())

n_meas = len(data_labels)

# build proper paths
for data in data_label_kwargs.values():
    data["confocal_template"] = DATA_ROOT / data["date"] / DATA_TYPE / data["confocal_template"]
    data["sted_template"] = (
        DATA_ROOT / data["date"] / DATA_TYPE / data["sted_template"]
        if data["sted_template"]
        else None
    )

# initialize the experiment dictionary, if it doens't already exist
if "exp_dict" not in locals():
    print("resetting 'exp_dict'")
    exp_dict = {}

for label in data_labels:
    if label not in exp_dict:
        exp_dict[label] = SolutionSFCSExperiment(name=label)

# TEST
print(data_label_kwargs)

# %% [markdown]
# Keeping the afterpulsing filter of the non-gated measurement to use with the gated one:

# %%
external_filter = np.array(
    [
        [
            5.47247078e-01,
            2.23864593e-01,
            1.80567800e-01,
            2.09433963e-01,
            2.81795931e-01,
            3.20887430e-01,
            3.44504774e-01,
            3.25229953e-01,
            4.60441179e-01,
            6.33193093e-01,
            9.14074912e-01,
            1.22411810e00,
            1.37671551e00,
            1.46450007e00,
            1.50868851e00,
            1.52635100e00,
            1.53625495e00,
            1.53856818e00,
            1.53839960e00,
            1.53796674e00,
            1.53740735e00,
            1.53651138e00,
            1.53497272e00,
            1.53503856e00,
            1.53352845e00,
            1.52024825e00,
            1.53114537e00,
            1.53003048e00,
            1.52894982e00,
            1.52581325e00,
            1.52416053e00,
            1.52357609e00,
            1.52209511e00,
            1.52129671e00,
            1.52080796e00,
            1.51938604e00,
            1.51797820e00,
            1.51710069e00,
            1.51506296e00,
            1.51449584e00,
            1.51070238e00,
            1.50852924e00,
            1.50575500e00,
            1.50278763e00,
            1.49995436e00,
            1.49837582e00,
            1.49773877e00,
            1.49646569e00,
            1.49610722e00,
            1.49501217e00,
            1.48390026e00,
            1.49323718e00,
            1.49149643e00,
            1.49145646e00,
            1.48723088e00,
            1.48214669e00,
            1.48102943e00,
            1.47751004e00,
            1.47494404e00,
            1.47200668e00,
            1.46918419e00,
            1.46553373e00,
            1.46430251e00,
            1.46510558e00,
            1.46444313e00,
            1.46058425e00,
            1.45712726e00,
            1.45111224e00,
            1.44623568e00,
            1.44194491e00,
            1.43930717e00,
            1.43482317e00,
            1.43411990e00,
            1.43357650e00,
            1.43166033e00,
            1.39989738e00,
            1.42875129e00,
            1.42173704e00,
            1.42151493e00,
            1.41497744e00,
            1.40748434e00,
            1.40814110e00,
            1.40440064e00,
            1.39641161e00,
            1.39379308e00,
            1.38329506e00,
            1.38041247e00,
            1.37881402e00,
            1.37396319e00,
            1.37758062e00,
            1.37023011e00,
            1.37192856e00,
            1.36881659e00,
            1.36035830e00,
            1.35760462e00,
            1.35089436e00,
            1.34471740e00,
            1.33956198e00,
            1.33526182e00,
            1.32660270e00,
            1.27085653e00,
            1.31593746e00,
            1.31090989e00,
            1.31147244e00,
            1.30585389e00,
            1.29840497e00,
            1.30231207e00,
            1.29465017e00,
            1.29450030e00,
            1.29109787e00,
            1.28175277e00,
            1.27180204e00,
            1.26682191e00,
            1.26101043e00,
            1.25800223e00,
            1.23491839e00,
            1.24312187e00,
            1.24238500e00,
            1.23707140e00,
            1.22965608e00,
            1.22121364e00,
            1.21281982e00,
            1.20531962e00,
            1.21289796e00,
            1.20081434e00,
            1.15941777e00,
            1.19764681e00,
            1.17773149e00,
            1.18406340e00,
            1.16817443e00,
            1.15130193e00,
            1.14941084e00,
            1.13320425e00,
            1.12642838e00,
            1.12986239e00,
            1.11584583e00,
            1.10780070e00,
            1.07992001e00,
            1.08831598e00,
            1.07943029e00,
            1.07679686e00,
            1.05911511e00,
            1.06304735e00,
            1.04099698e00,
            1.04981696e00,
            1.03355623e00,
            1.02305719e00,
            1.01703727e00,
            1.00587983e00,
            1.02137373e00,
            9.44343136e-01,
            1.02087288e00,
            1.00956839e00,
            9.97548502e-01,
            9.96073992e-01,
            9.86880018e-01,
            9.55698109e-01,
            9.37523440e-01,
            8.97039649e-01,
            8.84073270e-01,
            8.69981616e-01,
            8.72812985e-01,
            8.78694398e-01,
            8.95950295e-01,
            9.17923694e-01,
            9.19621013e-01,
            9.12809255e-01,
            9.14036425e-01,
            8.83825998e-01,
            8.52097474e-01,
            8.13063270e-01,
            8.23947825e-01,
            8.10185112e-01,
            8.62451189e-01,
            8.53510135e-01,
            8.08142224e-01,
            8.53241941e-01,
            8.58856916e-01,
            8.49257103e-01,
            8.02066872e-01,
            7.73850531e-01,
            7.47180188e-01,
            7.17565843e-01,
            7.18057913e-01,
            6.58616752e-01,
            6.88946919e-01,
            6.13989149e-01,
            6.29797222e-01,
            6.47016594e-01,
            6.36994766e-01,
            6.35003769e-01,
            6.76621525e-01,
            6.83081565e-01,
            6.48410570e-01,
            6.59256157e-01,
            6.67950341e-01,
            6.02345566e-01,
            6.07872502e-01,
            6.47158517e-01,
            5.84431581e-01,
            5.91723826e-01,
            5.79107326e-01,
            5.53168019e-01,
            5.60225636e-01,
            5.28261185e-01,
            5.15363300e-01,
            5.71417587e-01,
            5.43309874e-01,
            5.61710636e-01,
            5.46501314e-01,
            4.91176348e-01,
            5.14576105e-01,
            5.26276329e-01,
            4.77721425e-01,
            4.33922421e-01,
            4.96233101e-01,
            4.63961061e-01,
            4.99592620e-01,
            4.73728760e-01,
            4.19855381e-01,
            4.31009783e-01,
            4.42420021e-01,
            4.29538502e-01,
            4.19538236e-01,
            4.54810144e-01,
            2.99276823e-01,
            3.62525440e-01,
            3.69669810e-01,
            3.60403519e-01,
            3.43111289e-01,
            3.50111116e-01,
            3.19435420e-01,
            3.34427881e-01,
            3.37204261e-01,
            3.64170505e-01,
            3.95111778e-01,
            3.25697560e-01,
            3.50619665e-01,
            2.91607832e-01,
            3.00241061e-01,
            2.92479458e-01,
            2.84131452e-01,
            2.31642687e-01,
            2.50063936e-01,
            1.36160787e-01,
            1.74683081e-01,
            1.93798354e-01,
            1.77682667e-01,
            2.24275005e-01,
            1.50872155e-01,
            2.81197302e-01,
            2.76388674e-01,
            2.15626545e-01,
            2.65800951e-01,
            2.16937012e-01,
            1.38126554e-01,
            1.73681506e-01,
            1.49735275e-01,
            1.66615647e-01,
            5.30005199e-02,
            8.56184620e-02,
            9.37753454e-02,
            7.30471996e-02,
            4.44253587e-02,
            4.87369602e-02,
            1.27320299e-01,
            9.58543145e-02,
            7.34046153e-02,
            5.73816871e-02,
            6.05924789e-02,
            2.34020821e-02,
            4.50574277e-02,
            8.60328179e-02,
            8.65909767e-02,
            8.62739918e-02,
            5.96718064e-02,
            1.09748008e-01,
            5.80925628e-02,
            -3.80733948e-03,
            4.35998981e-02,
            2.84315551e-02,
            8.12231636e-02,
            -5.36378913e-02,
            8.71838716e-02,
            -1.00877318e-01,
            -2.25804434e-02,
            -5.93059796e-03,
            -5.35039365e-02,
            -8.38782186e-02,
            -1.26822956e-02,
            -5.20711819e-03,
            7.37352227e-03,
            1.32696097e-02,
            1.76270969e-03,
            5.04696904e-02,
            1.16031782e-02,
            -3.94794853e-02,
            -6.57872831e-02,
            -3.20857166e-02,
            -5.20825220e-02,
            -1.19872219e-01,
            -9.54921934e-02,
            -1.34444443e-01,
            -1.25488827e-01,
            -1.39226398e-01,
            -1.25028320e-01,
            -8.56588047e-02,
            -3.12390474e-02,
            -7.82031122e-02,
            -6.51965069e-02,
            -1.28876170e-01,
            -1.46817403e-01,
            -1.24545372e-01,
            -1.52375062e-01,
            -1.02298201e-01,
            -2.51800526e-01,
            -1.22033212e-01,
            -1.52462537e-01,
            -6.90252005e-02,
            -1.09158518e-01,
            -1.60790666e-01,
            -6.90772391e-02,
            -1.31596355e-01,
            -1.54319322e-01,
            -1.35905698e-01,
            -2.48226427e-01,
            -7.51311169e-02,
            -1.34444443e-01,
            -8.65178834e-02,
            -1.42971944e-01,
            -9.50842978e-02,
            -1.29551901e-01,
            -1.48860815e-01,
            -1.26334425e-01,
            -1.56258426e-01,
            -1.91845403e-01,
            -2.31588066e-01,
            -1.60652959e-01,
            -2.76596548e-01,
            -2.67933850e-01,
            -2.44103648e-01,
            -2.39084901e-01,
            -2.08851761e-01,
            -2.33471643e-01,
            -2.38127384e-01,
            -2.29319245e-01,
            -2.76174470e-01,
            -2.28883797e-01,
            -2.35046271e-01,
            -2.72645476e-01,
            -1.56367756e-01,
            -1.31282327e-01,
            -2.12203033e-01,
            -1.13232698e-01,
            -2.75368317e-01,
            -1.91974582e-01,
            -2.44553087e-01,
            -2.52588643e-01,
            -2.65025147e-01,
            -2.93303000e-01,
            -3.10770825e-01,
            -2.96815183e-01,
            -2.54691011e-01,
            -2.21489446e-01,
            -2.80717481e-01,
            -4.17208597e-01,
            -2.52394862e-01,
            -2.20953547e-01,
            -2.90422419e-01,
            -3.17409961e-01,
            -2.94935209e-01,
            -3.54426803e-01,
            -2.68399648e-01,
            -3.67562424e-01,
            -2.70286017e-01,
            -3.07991519e-01,
            -2.14731496e-01,
            -2.27822222e-01,
            -1.94662440e-01,
            -2.49608801e-01,
            -1.09625642e-01,
            -2.72309443e-01,
            -2.98811758e-01,
            -2.55762712e-01,
            -3.48155588e-01,
            -3.02871490e-01,
            -3.21816149e-01,
            -3.89491026e-01,
            -3.65382221e-01,
            -3.73837157e-01,
            -3.31452506e-01,
            -2.70352670e-01,
            -2.76502068e-01,
            -2.63471589e-01,
            -2.34206655e-01,
            -2.53379039e-01,
            -2.51480537e-01,
            -2.78550283e-01,
            -2.27495369e-01,
            -3.24872709e-01,
            -3.08873673e-01,
            -3.80098059e-01,
            -4.63885394e-01,
            -3.02674407e-01,
            -3.97169538e-01,
            -3.66074279e-01,
            -4.04133663e-01,
            -3.10347665e-01,
            -3.37036286e-01,
            -1.91277187e-01,
            -2.44745516e-01,
            -2.71419559e-01,
            -3.26097896e-01,
            -3.79802017e-01,
            -3.89737788e-01,
            -3.82219495e-01,
            -3.86541844e-01,
            -3.09012450e-01,
            -3.94118176e-01,
            -4.38857410e-01,
            -4.20800566e-01,
            -3.71750543e-01,
            -4.32272665e-01,
            -4.05719376e-01,
            -3.36179438e-01,
            -4.71876960e-01,
            -4.54814139e-01,
            -3.67892184e-01,
            -4.86972902e-01,
            -5.05406131e-01,
            -4.49680374e-01,
            -4.35603745e-01,
            -4.00677535e-01,
            -4.07675486e-01,
            -3.89979145e-01,
            -3.35889785e-01,
            -3.64616554e-01,
            -3.86449013e-01,
            -3.14603043e-01,
            -3.88136071e-01,
            -4.03517209e-01,
            -4.22653227e-01,
            -4.23022829e-01,
            -3.57571818e-01,
            -4.76709358e-01,
            -4.71680568e-01,
            -4.61653848e-01,
            -5.10254421e-01,
            -4.65847431e-01,
            -4.80224229e-01,
            -3.45766707e-01,
            -3.04140314e-01,
            -3.41942975e-01,
            -3.52581787e-01,
            -3.31437886e-01,
            -4.19007696e-01,
            -3.97700858e-01,
            -4.07272559e-01,
            -4.46858129e-01,
            -4.29051631e-01,
            -4.99455865e-01,
            -4.22739677e-01,
            -5.31600270e-01,
            -5.16334965e-01,
            -4.19021778e-01,
            -3.90012522e-01,
            -4.40565913e-01,
            -4.90313911e-01,
            -4.88721100e-01,
            -5.05613293e-01,
            -5.49618800e-01,
            -5.44600312e-01,
            -5.58296415e-01,
            -4.54892913e-01,
            -4.87556355e-01,
            -4.61512533e-01,
            -3.87179348e-01,
            -4.84232366e-01,
            -4.16864840e-01,
            -4.31123152e-01,
            -4.66005689e-01,
            -4.31615421e-01,
            -4.07272559e-01,
            -4.49358472e-01,
            -5.23745304e-01,
            -5.13952382e-01,
            -5.85215847e-01,
            -5.63605219e-01,
            -5.59974912e-01,
            -5.05138777e-01,
            -5.45602085e-01,
            -4.77371524e-01,
            -3.88424189e-01,
            -4.78854156e-01,
            -1.13691659e-01,
            -5.58247103e-02,
            -9.33332879e-02,
            -2.05462347e-01,
            -1.98950570e-01,
            -1.67896875e-01,
            -4.58423620e-01,
            -5.11084476e-01,
            -6.44825182e-01,
            -5.69712818e-01,
            -4.86324933e-01,
            -4.21427305e-01,
            -5.39253902e-01,
            -5.11020621e-01,
            -4.56896707e-01,
            -3.48155588e-01,
            -4.34379725e-01,
            -4.58807704e-01,
            -3.33258423e-01,
            -4.40790217e-01,
            -5.52923450e-01,
            -4.42807392e-01,
            -4.29013989e-01,
            -4.98866069e-01,
            -5.20174987e-01,
            6.05924789e-02,
            2.85083625e-02,
            4.14482102e-02,
            8.51383926e-03,
            3.18908201e-02,
            1.12654866e-01,
            -3.07110191e-01,
            -3.56398941e-01,
            -3.88694991e-01,
            -4.62153546e-01,
            -4.75577563e-01,
            -5.34024350e-01,
            -5.00221489e-01,
            -5.02265104e-01,
            -4.95445038e-01,
            -5.87829290e-01,
            -5.53618016e-01,
            -4.98830099e-01,
            -5.76315506e-01,
            -5.46448676e-01,
            -6.34925223e-01,
            -5.81334537e-01,
            -5.71141482e-01,
            -6.12063250e-01,
            -5.16350042e-01,
            -2.79658178e-01,
            -2.33285194e-01,
            -2.38746200e-01,
            -2.14930699e-01,
            -1.61269108e-01,
            -1.48149243e-01,
            -4.32040050e-01,
            -5.67167146e-01,
            -5.35569979e-01,
            -6.00338824e-01,
            -6.18526574e-01,
            -5.38086944e-01,
            -6.73978163e-01,
            -7.40331300e-01,
            -6.20385008e-01,
            -7.42745334e-01,
            -6.52755187e-01,
            -7.15443580e-01,
            -5.76315506e-01,
            -6.82994902e-01,
            -5.21435108e-01,
            -6.62313371e-01,
            -5.55163504e-01,
            -5.94694647e-01,
            -7.48178081e-01,
            -8.65048224e00,
            -8.76342476e00,
            -8.45227596e00,
            -9.08789025e00,
            -8.20295308e00,
            -8.88063271e00,
            -1.52558253e00,
            -7.41131324e-01,
            -6.65915308e-01,
            -6.54458202e-01,
            -5.94331568e-01,
            -5.95218397e-01,
            -5.95187968e-01,
            -5.98028574e-01,
            -5.85618149e-01,
            -6.55945772e-01,
            -5.46066492e-01,
            -6.02491901e-01,
            -6.24876329e-01,
            -7.05358936e-01,
            -6.65762986e-01,
            -7.09647238e-01,
            -7.29868245e-01,
            -6.23261376e-01,
            -5.88767410e-01,
            -6.91542571e-01,
            -6.11714831e-01,
            -5.10624803e-01,
            -6.35972901e-01,
            -6.48849014e-01,
            -6.98408246e-01,
            -8.75949567e-01,
            -6.08603617e-01,
            -5.90949802e-01,
            -7.58612245e-01,
            -7.27669399e-01,
            -7.00237184e-01,
            -7.40894922e-01,
            -6.77126713e-01,
            -6.65447659e-01,
            -5.30489816e-01,
            -6.73700009e-01,
            -6.52974539e-01,
            -6.21063262e-01,
            -5.74928697e-01,
            -6.95330844e-01,
            -5.54751966e-01,
            -7.14778603e-01,
            -6.82710185e-01,
            -7.52898004e-01,
            -6.08757221e-01,
            -7.57330681e-01,
            -6.76637892e-01,
            -6.84524487e-01,
            -8.58041185e-01,
            -7.53329690e-01,
            -5.27516884e-01,
            -7.31274599e-01,
            -6.03812742e-01,
            -5.91059666e-01,
            -6.07875238e-01,
            -5.38086944e-01,
            -6.99253033e-01,
            -6.31940359e-01,
            -5.02012260e-01,
            -4.84167617e-01,
            -4.99455865e-01,
            -5.64002118e-01,
            -5.83646521e-01,
            -7.12438741e-01,
            -7.38948907e-01,
            -6.61734420e-01,
            -7.21977844e-01,
            -7.85552919e-01,
            -7.35335312e-01,
            -6.87207941e-01,
            -7.23143429e-01,
            -7.28449573e-01,
            -7.55602260e-01,
            -6.95572057e-01,
            -8.22839216e-01,
            -9.20026689e-01,
            -8.86288137e-01,
            -7.91155590e-01,
            -4.59432634e-01,
            -5.16468953e-01,
            -4.71629838e-01,
            -5.37436561e-01,
            -6.07610948e-01,
            -5.60609597e-01,
            -6.45327508e-01,
            -5.74020537e-01,
            -7.26737244e-01,
            -6.53901548e-01,
            -6.80230174e-01,
            -6.76234196e-01,
            -5.75062444e-01,
            -5.65984752e-01,
            -5.56983315e-01,
            -5.66040448e-01,
            -5.75174784e-01,
            -5.09262272e-01,
            -5.15651597e-01,
            -4.35541824e-01,
            -4.85304742e-01,
            -6.17383861e-01,
            -8.10552416e-01,
            -7.59087188e-01,
            -7.61028477e-01,
            -6.67585428e-01,
            -7.34428459e-01,
            -6.16251020e-01,
            -6.57963014e-01,
            -7.01292224e-01,
            -3.89587210e-01,
            -6.23348693e-01,
            -6.73700009e-01,
            -6.65194510e-01,
            -6.73680553e-01,
            -5.46448676e-01,
            -5.87310613e-01,
            -6.71627609e-01,
            -7.09249073e-01,
            -7.48150738e-01,
            -6.72243334e-01,
            -6.01135086e-01,
            -6.76005854e-01,
            -5.63762443e-01,
            -6.91436757e-01,
            -6.82023668e-01,
            -6.00883454e-01,
            -8.11967782e-01,
            -5.14302126e-01,
            -5.36919973e-01,
            -6.41483618e-01,
            -4.60981424e-01,
            -5.68729368e-01,
            -5.78193794e-01,
            -5.87742075e-01,
            -4.71535437e-01,
            -5.95842206e-01,
            -6.21386205e-01,
            -5.80939539e-01,
            -6.21063262e-01,
            -7.09601555e-01,
            -6.84681823e-01,
            -7.78103263e-01,
            -7.61667955e-01,
            -7.45460432e-01,
            -7.38686297e-01,
            -7.31951562e-01,
            -6.97760658e-01,
            -6.66939922e-01,
            -6.98391407e-01,
            -6.95572057e-01,
            -7.29208273e-01,
            -6.13305761e-01,
            -5.33818198e-01,
            -4.99760823e-01,
            -4.80018242e-01,
            -6.63782585e-01,
            -5.90746122e-01,
            -6.47551916e-01,
            -7.07414772e-01,
            -7.80244512e-01,
            -7.23455013e-01,
            -7.47952521e-01,
            -7.57959956e-01,
            -6.40261807e-01,
            -6.85766411e-01,
            -6.78340181e-01,
            -7.08136589e-01,
            -7.10892804e-01,
            -7.13655676e-01,
            -7.33915498e-01,
            -7.54536870e-01,
            -8.14889080e-01,
            -7.26412807e-01,
            -6.72187970e-01,
            -7.97017876e-01,
            -8.03118514e-01,
            -7.22017349e-01,
            -6.26345288e-01,
            -5.49148001e-01,
            -6.03449551e-01,
            -6.76597184e-01,
            -6.46255731e-01,
            -6.48190752e-01,
            -6.50129144e-01,
            -3.34955058e-01,
            -7.54310004e-01,
            -7.31525835e-01,
            -7.66317616e-01,
            -7.37287093e-01,
            -6.38225725e-01,
            -6.45109825e-01,
            -6.49677041e-01,
            -6.47017718e-01,
            -6.44364740e-01,
            -6.43023726e-01,
            -6.41684329e-01,
            -9.02738956e-01,
            -6.37849114e-01,
            -7.25212544e-01,
            -6.15048288e-01,
            -5.83017241e-01,
            -3.64051408e-01,
            -8.58990692e-01,
            -7.44620065e-01,
            -7.33857548e-01,
            -6.55847200e-01,
            -6.59915982e-01,
            -7.76255000e-01,
            -6.61860593e-01,
            -3.45637323e-01,
            -6.38246670e-01,
            -5.73201273e-01,
            -7.33385850e-01,
            -6.49987387e-01,
            -6.32919387e-01,
            -6.55388641e-01,
            -6.85732807e-01,
            -7.45157896e-01,
            -6.53415438e-01,
            -6.39673087e-01,
            -6.26099029e-01,
            -9.82736027e-01,
            -6.70345433e-01,
            -5.76887245e-01,
            -6.07151247e-01,
            -6.34136182e-01,
            -4.72385045e-01,
            -5.21135884e-01,
            -4.24373125e-01,
            -3.40460229e-01,
            -3.92236771e-01,
            -3.11725541e-01,
            -2.07939296e-01,
            -2.25174991e-01,
            -1.09999141e-01,
            -9.73968458e-02,
            -5.82092574e-03,
            -5.35630241e-02,
            -4.00015388e-02,
            -3.73746746e-02,
            1.40898327e-02,
            5.26252557e-02,
            -4.34472349e-02,
            1.81277012e-02,
            2.52809982e-02,
            3.23689526e-02,
            2.11487851e-02,
            4.97559250e-02,
            9.02146937e-02,
            9.75029772e-02,
            5.25326556e-02,
            2.56611297e-01,
            2.33270087e-01,
            2.34958808e-01,
            1.67069683e-01,
            1.94266458e-01,
            1.50491642e-01,
            2.38508229e-01,
            2.60501225e-01,
            9.36247507e-02,
            1.96452480e-01,
            1.65514589e-01,
            2.06997854e-01,
            1.77523221e-01,
            2.59950514e-01,
            1.88564861e-01,
            2.69183214e-01,
            2.51520133e-01,
            2.81155322e-01,
            2.62197960e-01,
            2.42677771e-01,
            3.24163490e-01,
            2.04051412e-01,
            2.85785048e-01,
            2.33865756e-01,
            2.74647124e-01,
            -1.19278141e-01,
            4.62906316e-01,
            2.96771177e-01,
            2.94452717e-01,
            3.12927810e-01,
            3.24322663e-01,
            3.32907145e-01,
            3.43731080e-01,
            1.83718607e-01,
            2.95393315e-01,
            2.95217993e-01,
            2.89731615e-01,
            3.18390026e-01,
            3.19640539e-01,
            3.75279729e-01,
            3.51163987e-01,
            3.55744367e-01,
            3.45054585e-01,
            3.42491705e-01,
            3.39918141e-01,
            2.24492499e-01,
            3.27283907e-01,
            3.15633516e-01,
            3.13377735e-01,
            3.46056169e-01,
            2.41929224e-02,
            3.98021420e-01,
            2.73564574e-01,
            2.74752277e-01,
            3.07327058e-01,
            2.60133919e-01,
            3.16829087e-01,
            3.06601507e-01,
            2.97681194e-01,
            3.22000598e-01,
            3.70020036e-01,
            3.55471027e-01,
            3.41065230e-01,
            3.39045560e-01,
            2.81734841e-01,
            2.59726687e-01,
            3.09087568e-01,
            3.23771421e-01,
            3.23910358e-01,
            3.24049264e-01,
            3.62520840e-01,
            3.23136054e-01,
            3.11762452e-01,
            3.35631247e-01,
            3.09973648e-01,
            4.00037775e-02,
            4.08764207e-01,
            3.10496741e-01,
            3.36671376e-01,
            3.01160276e-01,
            2.28087711e-01,
            2.64530818e-01,
            3.00879451e-01,
            2.27434736e-01,
            2.99808161e-01,
            2.34992049e-01,
            2.94211038e-01,
            2.59599046e-01,
            2.59009643e-01,
            2.91397119e-01,
            2.90091557e-01,
            2.76666486e-01,
            2.65632495e-01,
            2.84946253e-01,
            3.03699436e-01,
            2.61859287e-01,
            3.02263690e-01,
            2.92934585e-01,
            2.67520901e-01,
            2.83950861e-01,
            2.43651935e-01,
            4.36718872e-01,
            3.36153294e-01,
            3.34145931e-01,
            3.26963808e-01,
            3.12556206e-01,
            2.92857711e-01,
            2.68895026e-01,
            2.73448447e-01,
            2.24322026e-01,
            1.62185213e-01,
            2.87878043e-01,
            2.67077520e-01,
            2.49048731e-01,
            2.88651208e-01,
            2.42458730e-01,
            2.73979494e-01,
            2.47388539e-01,
            2.26317030e-01,
            2.04566978e-01,
            2.61859287e-01,
            2.28874683e-01,
            2.46904633e-01,
            2.38610319e-01,
            2.13323060e-01,
            -2.46796409e-01,
            3.84443975e-01,
            2.70475461e-01,
            3.38181724e-01,
            2.78562076e-01,
            2.76490856e-01,
            2.87195790e-01,
            2.57874308e-01,
            2.32707141e-01,
            2.10697173e-01,
            1.88388639e-01,
            2.00377210e-01,
            2.38056479e-01,
            2.10188880e-01,
            2.59094791e-01,
            1.98889325e-01,
            2.20147174e-01,
            2.57007740e-01,
            2.60001678e-01,
            2.62982067e-01,
            1.07594422e-01,
            2.50646832e-01,
            2.03579921e-01,
            1.96551742e-01,
            1.76391028e-01,
            6.39685108e-02,
            6.39685108e-02,
            6.39685108e-02,
            6.39685108e-02,
            6.39685108e-02,
        ],
        [
            5.93930275e-01,
            8.33887402e-01,
            8.66014603e-01,
            8.44595256e-01,
            7.90901037e-01,
            7.61894260e-01,
            7.44369656e-01,
            7.58672010e-01,
            6.58342218e-01,
            5.30156386e-01,
            3.21735715e-01,
            9.16766490e-02,
            -2.15540836e-02,
            -8.66922145e-02,
            -1.19481043e-01,
            -1.32587005e-01,
            -1.39935966e-01,
            -1.41652433e-01,
            -1.41527345e-01,
            -1.41206150e-01,
            -1.40791073e-01,
            -1.40126243e-01,
            -1.38984519e-01,
            -1.39033373e-01,
            -1.37912838e-01,
            -1.28058627e-01,
            -1.36144540e-01,
            -1.35317269e-01,
            -1.34515394e-01,
            -1.32187988e-01,
            -1.30961630e-01,
            -1.30527964e-01,
            -1.29429039e-01,
            -1.28836608e-01,
            -1.28473944e-01,
            -1.27418850e-01,
            -1.26374204e-01,
            -1.25723071e-01,
            -1.24211025e-01,
            -1.23790208e-01,
            -1.20975375e-01,
            -1.19362855e-01,
            -1.17304308e-01,
            -1.15102450e-01,
            -1.13000100e-01,
            -1.11828790e-01,
            -1.11356082e-01,
            -1.10411431e-01,
            -1.10145437e-01,
            -1.09332889e-01,
            -1.01087597e-01,
            -1.08015801e-01,
            -1.06724131e-01,
            -1.06694472e-01,
            -1.03558996e-01,
            -9.97864070e-02,
            -9.89573781e-02,
            -9.63459122e-02,
            -9.44418802e-02,
            -9.22622945e-02,
            -9.01679398e-02,
            -8.74592131e-02,
            -8.65456226e-02,
            -8.71415200e-02,
            -8.66499635e-02,
            -8.37865914e-02,
            -8.12214221e-02,
            -7.67581461e-02,
            -7.31396272e-02,
            -6.99557799e-02,
            -6.79985139e-02,
            -6.46712869e-02,
            -6.41494467e-02,
            -6.37462309e-02,
            -6.23243847e-02,
            -3.87555579e-02,
            -6.01658110e-02,
            -5.49610803e-02,
            -5.47962685e-02,
            -4.99453010e-02,
            -4.43852526e-02,
            -4.48725845e-02,
            -4.20970768e-02,
            -3.61690370e-02,
            -3.42260259e-02,
            -2.64362606e-02,
            -2.42973165e-02,
            -2.31112259e-02,
            -1.95118036e-02,
            -2.21960192e-02,
            -1.67417704e-02,
            -1.80020605e-02,
            -1.56929089e-02,
            -9.41666783e-03,
            -7.37337090e-03,
            -2.39420925e-03,
            2.18923706e-03,
            6.01467341e-03,
            9.20548808e-03,
            1.56307568e-02,
            5.69956747e-02,
            2.35446069e-02,
            2.72751763e-02,
            2.68577461e-02,
            3.10268376e-02,
            3.65541097e-02,
            3.36549507e-02,
            3.93402516e-02,
            3.94514588e-02,
            4.19761453e-02,
            4.89104161e-02,
            5.62940866e-02,
            5.99894521e-02,
            6.43017048e-02,
            6.65338570e-02,
            8.36625854e-02,
            7.75754220e-02,
            7.81221942e-02,
            8.20650044e-02,
            8.75673380e-02,
            9.38318199e-02,
            1.00060231e-01,
            1.05625544e-01,
            1.00002247e-01,
            1.08968568e-01,
            1.39685757e-01,
            1.11318946e-01,
            1.26096562e-01,
            1.21398139e-01,
            1.33188116e-01,
            1.45707893e-01,
            1.47111130e-01,
            1.59136784e-01,
            1.64164629e-01,
            1.61616523e-01,
            1.72017121e-01,
            1.77986790e-01,
            1.98674897e-01,
            1.92444896e-01,
            1.99038283e-01,
            2.00992347e-01,
            2.14112606e-01,
            2.11194796e-01,
            2.27556666e-01,
            2.21012040e-01,
            2.33077868e-01,
            2.40868394e-01,
            2.45335310e-01,
            2.53614387e-01,
            2.42117560e-01,
            2.99276007e-01,
            2.42489204e-01,
            2.50877390e-01,
            2.59796421e-01,
            2.60890541e-01,
            2.67712678e-01,
            2.90850360e-01,
            3.04336376e-01,
            3.34376266e-01,
            3.43997613e-01,
            3.54453939e-01,
            3.52352999e-01,
            3.47988857e-01,
            3.35184591e-01,
            3.18879832e-01,
            3.17620382e-01,
            3.22674861e-01,
            3.21764273e-01,
            3.44181094e-01,
            3.67724378e-01,
            3.96688641e-01,
            3.88612054e-01,
            3.98824299e-01,
            3.60041686e-01,
            3.66676151e-01,
            4.00340168e-01,
            3.66875157e-01,
            3.62708719e-01,
            3.69831997e-01,
            4.04848217e-01,
            4.25785381e-01,
            4.45575380e-01,
            4.67549894e-01,
            4.67184767e-01,
            5.11291455e-01,
            4.88785784e-01,
            5.44406147e-01,
            5.32676199e-01,
            5.19899035e-01,
            5.27335458e-01,
            5.28812823e-01,
            4.97931506e-01,
            4.93138010e-01,
            5.18864673e-01,
            5.10817002e-01,
            5.04365720e-01,
            5.53045949e-01,
            5.48944837e-01,
            5.19793725e-01,
            5.66338532e-01,
            5.60927521e-01,
            5.70289249e-01,
            5.89536803e-01,
            5.84299891e-01,
            6.08018238e-01,
            6.17588760e-01,
            5.75995210e-01,
            5.96851769e-01,
            5.83197987e-01,
            5.94483649e-01,
            6.35536026e-01,
            6.18172877e-01,
            6.09491046e-01,
            6.45519884e-01,
            6.78019737e-01,
            6.31783801e-01,
            6.55730385e-01,
            6.29290962e-01,
            6.48482532e-01,
            6.88457799e-01,
            6.80180981e-01,
            6.71714326e-01,
            6.81272704e-01,
            6.88693128e-01,
            6.62520573e-01,
            7.77929820e-01,
            7.30997913e-01,
            7.25696630e-01,
            7.32572427e-01,
            7.45403654e-01,
            7.40209623e-01,
            7.62971684e-01,
            7.51846939e-01,
            7.49786802e-01,
            7.29777238e-01,
            7.06818113e-01,
            7.58325035e-01,
            7.39832269e-01,
            7.83620385e-01,
            7.77214333e-01,
            7.82973619e-01,
            7.89168028e-01,
            8.28115880e-01,
            8.14446897e-01,
            8.98965613e-01,
            8.70381198e-01,
            8.56197233e-01,
            8.68155437e-01,
            8.33582867e-01,
            8.88049444e-01,
            7.91345234e-01,
            7.94913344e-01,
            8.40000221e-01,
            8.02769675e-01,
            8.39027824e-01,
            8.97506969e-01,
            8.71124390e-01,
            8.88893035e-01,
            8.76367417e-01,
            9.60672414e-01,
            9.36469162e-01,
            9.30416570e-01,
            9.45797324e-01,
            9.67035378e-01,
            9.63836072e-01,
            9.05525455e-01,
            9.28873928e-01,
            9.45532113e-01,
            9.57421489e-01,
            9.55039008e-01,
            9.82635125e-01,
            9.66566368e-01,
            9.36161701e-01,
            9.35747534e-01,
            9.35982744e-01,
            9.55722168e-01,
            9.18564492e-01,
            9.56894003e-01,
            1.00282513e00,
            9.67647888e-01,
            9.78903142e-01,
            9.39730573e-01,
            1.03980053e00,
            9.35307593e-01,
            1.07485325e00,
            1.01675520e00,
            1.00440064e00,
            1.03970113e00,
            1.06223954e00,
            1.00941055e00,
            1.00386380e00,
            9.94528679e-01,
            9.90153649e-01,
            9.98692029e-01,
            9.62550347e-01,
            9.91390179e-01,
            1.02929467e00,
            1.04881565e00,
            1.02380833e00,
            1.03864641e00,
            1.08894790e00,
            1.07085737e00,
            1.09976082e00,
            1.09311555e00,
            1.10330914e00,
            1.09277385e00,
            1.06356077e00,
            1.02318008e00,
            1.05802848e00,
            1.04837728e00,
            1.09562904e00,
            1.10894184e00,
            1.09241549e00,
            1.11306575e00,
            1.07590758e00,
            1.18684169e00,
            1.09055141e00,
            1.11313066e00,
            1.05121826e00,
            1.08099809e00,
            1.11931032e00,
            1.05125688e00,
            1.09764748e00,
            1.11450843e00,
            1.10084511e00,
            1.18418963e00,
            1.05574899e00,
            1.09976082e00,
            1.06419823e00,
            1.10608842e00,
            1.07055470e00,
            1.09613044e00,
            1.11045810e00,
            1.09374300e00,
            1.11594729e00,
            1.14235363e00,
            1.17184359e00,
            1.11920813e00,
            1.20524090e00,
            1.19881298e00,
            1.18113043e00,
            1.17740641e00,
            1.15497274e00,
            1.17324125e00,
            1.17669591e00,
            1.17016007e00,
            1.20492771e00,
            1.16983696e00,
            1.17440966e00,
            1.20230912e00,
            1.11602842e00,
            1.09741446e00,
            1.15745946e00,
            1.08402123e00,
            1.20432953e00,
            1.14244949e00,
            1.18146393e00,
            1.18742649e00,
            1.19665466e00,
            1.21763747e00,
            1.23059899e00,
            1.22024359e00,
            1.18898650e00,
            1.16435018e00,
            1.20829873e00,
            1.30957823e00,
            1.18728270e00,
            1.16395254e00,
            1.21550001e00,
            1.23552538e00,
            1.21884860e00,
            1.26299271e00,
            1.19915862e00,
            1.27273964e00,
            1.20055835e00,
            1.22853668e00,
            1.15933563e00,
            1.16904925e00,
            1.14444394e00,
            1.18521538e00,
            1.08134471e00,
            1.20205977e00,
            1.22172509e00,
            1.18978172e00,
            1.25833933e00,
            1.22473750e00,
            1.23879487e00,
            1.28901116e00,
            1.27112188e00,
            1.27739564e00,
            1.24594527e00,
            1.20060780e00,
            1.20517080e00,
            1.19550189e00,
            1.17378664e00,
            1.18801298e00,
            1.18660425e00,
            1.20669062e00,
            1.16880672e00,
            1.24106291e00,
            1.22919126e00,
            1.28204137e00,
            1.34421347e00,
            1.22459126e00,
            1.29470879e00,
            1.27163541e00,
            1.29987633e00,
            1.23028500e00,
            1.25008856e00,
            1.14193200e00,
            1.18160672e00,
            1.20139946e00,
            1.24197202e00,
            1.28182170e00,
            1.28919426e00,
            1.28361552e00,
            1.28682280e00,
            1.22929424e00,
            1.29244461e00,
            1.32564214e00,
            1.31224355e00,
            1.27584732e00,
            1.32075611e00,
            1.30105297e00,
            1.24945276e00,
            1.35014339e00,
            1.33748239e00,
            1.27298433e00,
            1.36134492e00,
            1.37502279e00,
            1.33367302e00,
            1.32322784e00,
            1.29731180e00,
            1.30250444e00,
            1.28937336e00,
            1.24923783e00,
            1.27055374e00,
            1.28675392e00,
            1.23344258e00,
            1.28800575e00,
            1.29941891e00,
            1.31361827e00,
            1.31389252e00,
            1.26532639e00,
            1.35372914e00,
            1.34999766e00,
            1.34255761e00,
            1.37862034e00,
            1.34566934e00,
            1.35633725e00,
            1.25656673e00,
            1.22567900e00,
            1.25372943e00,
            1.26162367e00,
            1.24593442e00,
            1.31091320e00,
            1.29510304e00,
            1.30220546e00,
            1.33157885e00,
            1.31836603e00,
            1.37060756e00,
            1.31368241e00,
            1.39445944e00,
            1.38313224e00,
            1.31092365e00,
            1.28939812e00,
            1.32690988e00,
            1.36382403e00,
            1.36264212e00,
            1.37517651e00,
            1.40782960e00,
            1.40410576e00,
            1.41426858e00,
            1.33754084e00,
            1.36177786e00,
            1.34245275e00,
            1.28729584e00,
            1.35931138e00,
            1.30932315e00,
            1.31990314e00,
            1.34578677e00,
            1.32026842e00,
            1.30220546e00,
            1.33343416e00,
            1.38863088e00,
            1.38136431e00,
            1.43424341e00,
            1.41820784e00,
            1.41551407e00,
            1.37482441e00,
            1.40484910e00,
            1.35422048e00,
            1.28821954e00,
            1.35532063e00,
            1.08436179e00,
            1.04142320e00,
            1.06925541e00,
            1.15245771e00,
            1.14762583e00,
            1.12458328e00,
            1.34016071e00,
            1.37923626e00,
            1.47847489e00,
            1.42273981e00,
            1.36086411e00,
            1.31270860e00,
            1.40013861e00,
            1.37918887e00,
            1.33902770e00,
            1.25833933e00,
            1.32231959e00,
            1.34044571e00,
            1.24728530e00,
            1.32707632e00,
            1.41028172e00,
            1.32857311e00,
            1.31833810e00,
            1.37016992e00,
            1.38598162e00,
            9.55039008e-01,
            9.78846149e-01,
            9.69244489e-01,
            9.93682538e-01,
            9.76336289e-01,
            9.16407538e-01,
            1.22788272e00,
            1.26445609e00,
            1.28842049e00,
            1.34292840e00,
            1.35288932e00,
            1.39625816e00,
            1.37117567e00,
            1.37269208e00,
            1.36763144e00,
            1.43618265e00,
            1.41079711e00,
            1.37014323e00,
            1.42763916e00,
            1.40547729e00,
            1.47112889e00,
            1.43136339e00,
            1.42379991e00,
            1.45416479e00,
            1.38314342e00,
            1.20751270e00,
            1.17310290e00,
            1.17715509e00,
            1.15948345e00,
            1.11966533e00,
            1.10993009e00,
            1.32058350e00,
            1.42085087e00,
            1.39740505e00,
            1.44546500e00,
            1.45896073e00,
            1.39927270e00,
            1.50010706e00,
            1.54934259e00,
            1.46033973e00,
            1.55113386e00,
            1.48435913e00,
            1.53087534e00,
            1.42763916e00,
            1.50679768e00,
            1.38691666e00,
            1.49145152e00,
            1.41194389e00,
            1.44127690e00,
            1.55516508e00,
            7.41885373e00,
            7.50265963e00,
            7.27178018e00,
            7.74342038e00,
            7.08677695e00,
            7.58963058e00,
            2.13201678e00,
            1.54993623e00,
            1.49412424e00,
            1.48562281e00,
            1.44100748e00,
            1.44166553e00,
            1.44164295e00,
            1.44375074e00,
            1.43454193e00,
            1.48672662e00,
            1.40519370e00,
            1.44706263e00,
            1.46367239e00,
            1.52339230e00,
            1.49401121e00,
            1.52657432e00,
            1.54157877e00,
            1.46247406e00,
            1.43687875e00,
            1.51314025e00,
            1.45390626e00,
            1.37889517e00,
            1.47190629e00,
            1.48146066e00,
            1.51823473e00,
            1.64997442e00,
            1.45159767e00,
            1.43849814e00,
            1.56290747e00,
            1.53994717e00,
            1.51959185e00,
            1.54976081e00,
            1.50244336e00,
            1.49377723e00,
            1.39363546e00,
            1.49990066e00,
            1.48452190e00,
            1.46084300e00,
            1.42661011e00,
            1.51595123e00,
            1.41163852e00,
            1.53038191e00,
            1.50658642e00,
            1.55866737e00,
            1.45171164e00,
            1.56195652e00,
            1.50208064e00,
            1.50793267e00,
            1.63668599e00,
            1.55898769e00,
            1.39142947e00,
            1.54262231e00,
            1.44804273e00,
            1.43857966e00,
            1.45105719e00,
            1.39927270e00,
            1.51886159e00,
            1.46891406e00,
            1.37250447e00,
            1.35926334e00,
            1.37060756e00,
            1.41850234e00,
            1.43307894e00,
            1.52864568e00,
            1.54831682e00,
            1.49102193e00,
            1.53572391e00,
            1.58289806e00,
            1.54563545e00,
            1.50992385e00,
            1.53658880e00,
            1.54052608e00,
            1.56067399e00,
            1.51613022e00,
            1.61056533e00,
            1.68268064e00,
            1.65764587e00,
            1.58705536e00,
            1.34090942e00,
            1.38323166e00,
            1.34996002e00,
            1.39879010e00,
            1.45086108e00,
            1.41598502e00,
            1.47884762e00,
            1.42593624e00,
            1.53925549e00,
            1.48520976e00,
            1.50474619e00,
            1.50178109e00,
            1.42670936e00,
            1.41997350e00,
            1.41329423e00,
            1.42001483e00,
            1.42679272e00,
            1.37788414e00,
            1.38262516e00,
            1.32318190e00,
            1.36010711e00,
            1.45811281e00,
            1.60144825e00,
            1.56325988e00,
            1.56470036e00,
            1.49536351e00,
            1.54496255e00,
            1.45727221e00,
            1.48822346e00,
            1.52037471e00,
            1.28908253e00,
            1.46253885e00,
            1.49990066e00,
            1.49358939e00,
            1.49988623e00,
            1.40547729e00,
            1.43579777e00,
            1.49836290e00,
            1.52627887e00,
            1.55514479e00,
            1.49881978e00,
            1.44605585e00,
            1.50161165e00,
            1.41832450e00,
            1.51306173e00,
            1.50607701e00,
            1.44586913e00,
            1.60249848e00,
            1.38162382e00,
            1.39840678e00,
            1.47599537e00,
            1.34205866e00,
            1.42201007e00,
            1.42903289e00,
            1.43611793e00,
            1.34988997e00,
            1.44212841e00,
            1.46108264e00,
            1.43107029e00,
            1.46084300e00,
            1.52654042e00,
            1.50804942e00,
            1.57737024e00,
            1.56517487e00,
            1.55314852e00,
            1.54812196e00,
            1.54312464e00,
            1.51775421e00,
            1.49488453e00,
            1.51822224e00,
            1.51613022e00,
            1.54108905e00,
            1.45508676e00,
            1.39610519e00,
            1.37083385e00,
            1.35618441e00,
            1.49254171e00,
            1.43834700e00,
            1.48049819e00,
            1.52491778e00,
            1.57895910e00,
            1.53682000e00,
            1.55499771e00,
            1.56242345e00,
            1.47508876e00,
            1.50885421e00,
            1.50334378e00,
            1.52545339e00,
            1.52749856e00,
            1.52954867e00,
            1.54458192e00,
            1.55988344e00,
            1.60466615e00,
            1.53901475e00,
            1.49877870e00,
            1.59140531e00,
            1.59593212e00,
            1.53575322e00,
            1.46476239e00,
            1.40748025e00,
            1.44777323e00,
            1.50205043e00,
            1.47953639e00,
            1.48097222e00,
            1.48241055e00,
            1.24854424e00,
            1.55971511e00,
            1.54280874e00,
            1.56862503e00,
            1.54708372e00,
            1.47357794e00,
            1.47868610e00,
            1.48207508e00,
            1.48010180e00,
            1.47813323e00,
            1.47713817e00,
            1.47614430e00,
            1.66985275e00,
            1.47329849e00,
            1.53812413e00,
            1.45637976e00,
            1.43261200e00,
            1.27013439e00,
            1.63739055e00,
            1.55252495e00,
            1.54453892e00,
            1.48665347e00,
            1.48967260e00,
            1.57599879e00,
            1.49111555e00,
            1.25647072e00,
            1.47359348e00,
            1.42532833e00,
            1.54418891e00,
            1.48230536e00,
            1.46964052e00,
            1.48631321e00,
            1.50882927e00,
            1.55292403e00,
            1.48484905e00,
            1.47465192e00,
            1.46457966e00,
            1.72921239e00,
            1.49741149e00,
            1.42806340e00,
            1.45051998e00,
            1.47054341e00,
            1.35052040e00,
            1.38669463e00,
            1.31489447e00,
            1.25262920e00,
            1.29104857e00,
            1.23130741e00,
            1.15429567e00,
            1.16708494e00,
            1.08162185e00,
            1.07227067e00,
            1.00431926e00,
            1.03974498e00,
            1.02968205e00,
            1.02773285e00,
            9.89545025e-01,
            9.60950869e-01,
            1.03223883e00,
            9.86548835e-01,
            9.81240927e-01,
            9.75981504e-01,
            9.84307122e-01,
            9.63079977e-01,
            9.33058654e-01,
            9.27650583e-01,
            9.61019580e-01,
            8.09588606e-01,
            8.26908313e-01,
            8.25655244e-01,
            8.76030511e-01,
            8.55849888e-01,
            8.88331794e-01,
            8.23021493e-01,
            8.06702192e-01,
            9.30528315e-01,
            8.54227811e-01,
            8.77184427e-01,
            8.46402904e-01,
            8.68273749e-01,
            8.07110832e-01,
            8.60080603e-01,
            8.00259959e-01,
            8.13366365e-01,
            7.91376384e-01,
            8.05443176e-01,
            8.19927598e-01,
            7.59463349e-01,
            8.48589231e-01,
            7.87941023e-01,
            8.26466313e-01,
            7.96205614e-01,
            1.08850708e00,
            6.56513031e-01,
            7.79789066e-01,
            7.81509416e-01,
            7.67800479e-01,
            7.59345239e-01,
            7.52975359e-01,
            7.44943754e-01,
            8.63676633e-01,
            7.80811471e-01,
            7.80941563e-01,
            7.85012580e-01,
            7.63747390e-01,
            7.62819481e-01,
            7.21533943e-01,
            7.39428369e-01,
            7.36029623e-01,
            7.43961684e-01,
            7.45863399e-01,
            7.47773042e-01,
            8.33421482e-01,
            7.57147929e-01,
            7.65792783e-01,
            7.67466624e-01,
            7.43218486e-01,
            9.82048304e-01,
            7.04659093e-01,
            7.97008891e-01,
            7.96127588e-01,
            7.71956363e-01,
            8.06974741e-01,
            7.64905643e-01,
            7.72494739e-01,
            7.79113813e-01,
            7.61068264e-01,
            7.25436754e-01,
            7.36232448e-01,
            7.46921876e-01,
            7.48420517e-01,
            7.90946367e-01,
            8.07276917e-01,
            7.70650025e-01,
            7.59754273e-01,
            7.59651179e-01,
            7.59548108e-01,
            7.31001327e-01,
            7.60225730e-01,
            7.68665200e-01,
            7.50954014e-01,
            7.69992533e-01,
            9.70316291e-01,
            6.96687701e-01,
            7.69604387e-01,
            7.50182215e-01,
            7.76532255e-01,
            8.30753753e-01,
            8.03712142e-01,
            7.76740633e-01,
            8.31238275e-01,
            7.77535555e-01,
            8.25630578e-01,
            7.81688747e-01,
            8.07371629e-01,
            8.07808980e-01,
            7.83776738e-01,
            7.84745495e-01,
            7.94707202e-01,
            8.02894673e-01,
            7.88563427e-01,
            7.74648141e-01,
            8.05694479e-01,
            7.75713497e-01,
            7.82635904e-01,
            8.01493433e-01,
            7.89302031e-01,
            8.19204746e-01,
            6.75944707e-01,
            7.50566644e-01,
            7.52056152e-01,
            7.57385450e-01,
            7.68076217e-01,
            7.82692946e-01,
            8.00473801e-01,
            7.97095060e-01,
            8.33547977e-01,
            8.79654899e-01,
            7.86387973e-01,
            8.01822432e-01,
            8.15200201e-01,
            7.85814267e-01,
            8.20090132e-01,
            7.96701011e-01,
            8.16432102e-01,
            8.32067638e-01,
            8.48206670e-01,
            8.05694479e-01,
            8.30169802e-01,
            8.16791171e-01,
            8.22945740e-01,
            8.41709458e-01,
            1.18312852e00,
            7.14733864e-01,
            7.99301082e-01,
            7.49061502e-01,
            7.93300631e-01,
            7.94837523e-01,
            7.86894220e-01,
            8.08651423e-01,
            8.27326032e-01,
            8.43657926e-01,
            8.60211364e-01,
            8.51315572e-01,
            8.23356702e-01,
            8.44035091e-01,
            8.07745798e-01,
            8.52419617e-01,
            8.36645811e-01,
            8.09294437e-01,
            8.07072867e-01,
            8.04861351e-01,
            9.20162502e-01,
            8.14014374e-01,
            8.48939089e-01,
            8.54154156e-01,
            8.69113862e-01,
            9.52533916e-01,
            9.52533916e-01,
            9.52533916e-01,
            9.52533916e-01,
            9.52533916e-01,
        ],
    ]
)

with Plotter(super_title="External Filter") as ax:
    ax.plot(external_filter.T)

# %% [markdown]
# Importing all needed data. Processing, correlating and averaging if no pre-processed measurement exist.

# %%
used_labels = data_labels
# used_labels = [
#    "sample"
# ]

# load experiment
for label in used_labels:
    # skip already loaded experiments, unless forced
    if not hasattr(exp_dict[label], "confocal") or data_label_kwargs[label]["force_processing"]:
        exp_dict[label].load_experiment(
            should_plot=False,
            should_re_correlate=FORCE_ALL,
            external_ap_filter=external_filter,
            **data_label_kwargs[label],
        )

        # plot TDC calibration
        exp_dict[label].confocal.tdc_calib.plot()

        # save processed data (to avoid re-processing)
        exp_dict[label].save_processed_measurements(
            should_force=FORCE_ALL,
        )

# Present count-rates
for label in used_labels:
    exp = exp_dict[label]
    print(f"'{label}' countrates:")
    print(f"Confocal: {exp.confocal.avg_cnt_rate_khz:.2f} +/- {exp.confocal.std_cnt_rate_khz:.2f}")
    with suppress(AttributeError):
        print(f"STED: {exp.sted.avg_cnt_rate_khz:.2f} +/- {exp.sted.std_cnt_rate_khz:.2f}")
    print()


# %% [markdown]
# ## Plotting both CF_CRs together

# %%
with Plotter() as ax:
    for label, exp in exp_dict.items():
        exp.plot_correlation_functions(
            parent_ax=ax,
            y_field="avg_cf_cr",
            x_field="lag",
            x_scale="log",
            xlim=None,  # autoscale x axis
        )

# %% [markdown]
# ## Checking out the afterpulsings

# %% [markdown]
# #### Caculate the filtered afterpulsings

# %%
for label, exp in exp_dict.items():
    exp.confocal.calculate_filtered_afterpulse()

# %%
FACTOR = 1  # 1.45

with Plotter(
    xlim=(5e-4, 1),
    ylim=(0, 1.1e4),
    x_scale="log",
    xlabel="lag (ms)",
    ylabel="Avg. CF x CR",
) as ax:
    for label, exp in exp_dict.items():
        meas = exp.confocal
        # plot the filters
        print()
        meas.tdc_calib.calculate_afterpulsing_filter(should_plot=True)
        cf_dict = meas.cf
        for cf_label, cf in cf_dict.items():
            ax.plot(
                cf.lag,
                cf.avg_cf_cr * FACTOR
                if label == "gated 12 uW" and cf_label == "confocal"
                else cf.avg_cf_cr,
                label=f"{label}: {cf_label}",
            )
    ax.legend()
